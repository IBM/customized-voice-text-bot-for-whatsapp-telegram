<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Customized voice-text bot for WhatsApp and Telegram</title>

    <link rel="stylesheet" href="../src/stylesheets/styles.css">
    <link rel="stylesheet" href="../src/stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h2>IBM Research</h2>

        <p class="view"><a href="https://github.com/IBM/customized-voice-text-bot-for-whatsapp-telegram">View the Project on GitHub <small>IBM/customized-voice-text-bot-for-whatsapp-telegram</small></a></p><br>
        <h3>Learn more about</h3>
        <h4>
          Running locally<br>
          <a href="../runninglocallytelegram">Telegram</a><br>
          <a href="../runninglocallywhatsapp"> WhatsApp</a><br>
          <div style="height:10px"></div>
          Deploying to IBM Cloud and others<br>
          <a href="../deploymenttelegram">Telegram </a><br>
          <a href="../deploymentwhatsapp">WhatsApp </a><br>
        </h4>
  
        <a href="../watsonservices"> Setup Watson Services</a><br>
        <a href="../datastorage"> Setup Data Storage</a><br>
        <a target="_blank" rel="noopener" href="https://cloud.ibm.com/docs/text-to-speech?topic=text-to-speech-customIntro"> Customizing Text-to-Speech</a><br>
        <a target="_blank" rel="noopener" href="https://cloud.ibm.com/docs/speech-to-text?topic=speech-to-text-customization"> Customizing Speech-to-Text</a><br>
        <p></p><br>
      </header>
      <section>
        <h1>
          <a id="title-page" class="anchor" href="../" style="color:#222" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span>Voice and Text Chatbot designed for WhatsApp and Telegram</a>
        </h1>
        <h2>
          <a id="instructions-for-running-locally" class="anchor" href="#instructions-for-running-locally" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Instructions for Running Locally Telegram Bot Application</strong>
        </h2>
        <p>Please follow these following subsections in order, to run the Telegram Bot app locally.</p>
        <h3>
          <a id="necessary-components" class="anchor" href="#necessary-components" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Necessary Components</strong>
        </h3>
        <p>To locally run the app successfully, please ensure that you have these components ready:</p>
        <ul>
          <li>Telegram Bot API key and Telegram account
            <ul><li>The API key is required for connecting the web app to Telegram. You can get more information on how to create a new bot account with BotFather <a href="https://blog.devgenius.io/how-to-set-up-your-telegram-bot-using-botfather-fd1896d68c02" target="_blank"> here</a>.<br> The account is required to test the bot after the deployment. </li></ul>
          </li>
        <li>IBM Cloud account (credit card required; no payment - all used services are free)
        <ul>
        Create an instance for the <strong>free versions</strong> of the following services (you can select Dallas as the location):
          <li style="margin-left:2em"><a target="_blank" href="https://cloud.ibm.com/catalog/services/speech-to-text">Speech-to-Text</a></li>
          <li style="margin-left:2em;"><a target="_blank" href="https://cloud.ibm.com/catalog/services/text-to-speech">Text-to-Speech</a></li>
          <li style="margin-left:2em"><a target="_blank" href="https://cloud.ibm.com/catalog/services/watson-assistant">Watson Assistant</a> <font style="font-size:12px;"><i>(please see the section <a href="../watsonservices/index.html"> Watson Services</a>)</i></font></li>
          <li style="margin-left:2em;"><a href="https://cloud.ibm.com/objectstorage/create" target="_blank">Object Storage</a></li>
          <li style="margin-left:2em;"><a href="https://cloud.ibm.com/catalog/services/cloudant" target="_blank">Cloudant</a></li>
        </ul>
        <li>
          <a href="https://ngrok.com/download">ngrok</a> downloaded and installed
          <ul>
            <li>Also, a free ngrok account</li>
          </ul>
        </li>
      </ul>
        

        <h4>
          <a id="ngrok" class="anchor" href="#ngrok" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>ngrok</strong>
          </h4>
          <p><a href="https://ngrok.com/product">ngrok</a> is a third-party software that can be used to expose "local servers to the public internet over secure tunnels" (ngrok documentation). Basically, ngrok provides a random public url that can forward requests to a local host.</p>
          
        <h3>
        <a id="environment-set-up" class="anchor" href="#environment-set-up" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Environment Set-up</strong>
        </h3>
        <p>After acquiring the necessary components and cloning our GitHub repository, you would need to create a <strong>Python 3 virtual environment</strong> (using <a href="https://packaging.python.org/tutorials/installing-packages/#creating-and-using-virtual-environments">virtualenv</a> for example), and install the dependencies. Below you can see how to do these steps:</p>
         <ul>
          <i>In the project local folder in your computer</i>: 
          <li>Creating the virtual environment:
            <ul><li>Mac/Linux/Windows <code>$ python3 -m venv &ltname_of_virtualenv&gt </code></li></ul>
          </li>
          <li>Activating the virtual environment:
            <ul>
              <li>Mac/Linux (bash/zsh) - <code>$ source &ltvenv&gt/bin/activate</code></li>
              <li>Windows (cmd.exe) - <code>C:\&gt &ltvenv&gt\Scripts\activate.bat</code></li>
              <li>Windows (PowerShell) - <code>PS C:\&gt &ltvenv&gt\Scripts\Activate.ps1</code></li>
            </ul>
          </li>
          <li>Installing the dependencies:
            <ul>
              <li>Should work on Windows - <code>$ pip install -r requirements_windows_local.txt</code></li>
              <li>Should work on Mac - <code>$ python3 -m pip install -r requirements.txt</code></li>
            </ul>
          </li>
        </ul>

  <p>In the <code>src</code> directory, you should also create a <strong>.env file</strong>. This will <a href="https://dev.to/jakewitcher/using-env-files-for-environment-variables-in-python-applications-55a1">store the API keys</a> and the code will search for them.</p>
  <ul>
  <li>Mac/Linux - <code>$ touch .env</code>
  </li>
  <li>Windows - <code>$ type nul &gt; your_file.txt</code>
  </li>
  </ul>
  <p>In the .env file, you can store <strong>API keys</strong> with these exact names. 
    We do this to protect sensitive information, namely, API keys and other IDs. 
    STT, TTS, Watson Assistant, COS and Cloudant API keys can be found on the IBM Cloud website (by going to Resource List and then opening each service). For the Watson Assistant ID, you first have to launch Watson Assistant (this can be done from the resource list) and create an assistant. After that, under Assistant Settings the assistant ID will be there.</p>
  <p>These are the API keys that you will need to run the app:</p>
  <ul>
    <li>COS_API_KEY_ID <sup>1</sup></li>
    <li>COS_BUCKET_LINK <sup>1</sup></li>
    <li>COS_BUCKET <sup>1</sup></li>
    <li>COS_ENDPOINT <sup>1</sup></li>
    <li>COS_INSTANCE_CRN <sup>1</sup></li>
    <li>IBM_CLOUDANT_APIKEY <sup>1</sup></li>
    <li>IBM_CLOUDANT_DATABASE <sup>1</sup></li>
    <li>IBM_CLOUDANT_URL <sup>1</sup></li>
    <li>STT_API_KEY <sup>2</sup></li>
    <li>STT_LANGUAGE <sup>2</sup></li>
    <li>STT_MODEL <sup>2</sup></li>
    <li>STT_SERVICE_URL <sup>2</sup></li>
    <li>TELEGRAM_BOT_TOKEN <sup>3</sup></li>
    <li>TELEGRAM_PORT <sup>3</sup></li>
    <li>TELEGRAM_WEBHOOK_URL <sup>3</sup></li>
    <li>TTS_API_KEY <sup>2</sup></li>
    <li>TTS_DEFAULT_VOICE <sup>2</sup></li>
    <li>TTS_SERVICE_URL <sup>2</sup></li>
    <li>WA_API_KEY <sup>2</sup></li> 
    <li>WA_DEFAULT_ERROR_MESSAGE <sup>2</sup></li> 
    <li>WA_ID <sup>2</sup></li> 
    <li>WA_SERVICE_URL <sup>2</sup></li> 
     <br>
    <sup>1</sup>Refer to <a href="https://ibm.github.io/customized-voice-text-bot-for-whatsapp-telegram/datastorage/"> Data Storage page</a><Br>
    <sup>2</sup>Refer to <a href="https://ibm.github.io/customized-voice-text-bot-for-whatsapp-telegram/watsonservices/"> Watson Services page</a><br>
    <sup>3</sup>The Bot Token is given by BotFather when creating a new bot (<a href="https://blog.devgenius.io/how-to-set-up-your-telegram-bot-using-botfather-fd1896d68c02" target="_blank">refer here</a>).<br>The TELEGRAM_PORT value is the port that the deployed app listen for incoming connections, by default is 8080.<br>The TELEGRAM_WEBHOOK_URL is your web application main address, with a backslash in the end. <br>
    </ul>
  
  <p>The following image is an example of how the <code>.env</code> file should be formatted - without the variables values, of course:</p>
  <img src="../src/images/envs_telegram.png"><br><br>

  <h3>
  <a id="running-the-app" class="anchor" href="#running-the-app" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Running the App</strong>
  </h3>
  <p>First, run the command for your respective OS on the command line (in the folder ngrok were installed):</p>
  <ul>
  <li>Mac/Linux - <code>$ ./ngrok http 8080</code>
  </li>
  <li>Windows - <code>$ ngrok http 8080</code>
  </li>
  </ul>
  <p>After this, an ngrok interface, similar to this, should appear:</p>
  <img src="../src/images/ngrok_interface.jpg" alt="See ../src/images/ngrok_interface.jpg">
  <p>There would be two "Forwarding" sections of the interface - you can copy the <code>https://____.ngrok.io/</code> url, and store this as <code>TELEGRAM_WEBHOOK_URL</code> in your .env file.</p>
  
  <p>After this is done you are prepared to run the app and send messages.</p>
  <p>It is time to run the application. In the <code>src/</code> folder:</p>
  <ul><li>Mac/Linux/Windows <code>$ python3 telegram_bot.py </code></li></ul>

  <p>Congratulations! The application is ready to receive requests. You now should be able to interact with the bot on Telegram. Yeeey!</p>
  
  <p>You can monitor bot activity through <strong>Cloudant database</strong> and access the media files sent and received by the bot in the <strong>Cloud Object Storage bucket</strong> you create.</p>
  <p>Of course, there should also be a working Watson Assistant dialog skill attached to your Watson Assistant assistant (that correlates with <code>WATSON_ASSISTANT_ID</code>) in order for you to receive sensible responses from the app.</p>
  
  <h3>
  <a id="handling-errors" class="anchor" href="#handling-errors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Handling Errors</strong>
  </h3>
  <p>The code has try-except blocks in many places, so as to catch specific errors from the services. Most errors should produce a debug output within the terminal.</p>
  
</section>
      <footer>
        <p style="font-size:12px;">Project maintainers: <br><a target="_blank" rel="noopener" href="https://github.com/adinanabf">Adinan Brito Filho</a> <br><a target="_blank" rel="noopener" href="https://github.com/marcelo-grave">Marcelo Grave</a> <br><a target="_blank" rel="noopener" href="https://github.com/cassiasamp">Cássia Sampaio</a></p></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="../src/javascripts/scale.fix.js"></script>
    
  </body>
</html>
